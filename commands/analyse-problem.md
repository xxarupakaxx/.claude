---
description: Comprehensive A3 one-page problem analysis with root cause and action plan
argument-hint: 文書化する問題の説明（オプション）
---

# A3問題分析

包括的な1ページ問題文書化と解決計画のためのA3問題解決フォーマットを適用。

## 説明

7つのセクションをカバーする構造化された1ページ分析フォーマット: 背景、現状、目標、根本原因分析、対策、実施計画、フォローアップ。A3用紙サイズにちなんで命名; 簡潔で完全な文書化を重視。

## 使用方法

`/analyse-problem [問題の説明]`

## 変数

- PROBLEM: 分析する問題（デフォルト: 入力を促す）
- OUTPUT_FORMAT: markdownまたはtext（デフォルト: markdown）

## 手順

1. **背景**: この問題がなぜ重要か（コンテキスト、ビジネスインパクト）
2. **現状**: 今何が起きているか（データ、メトリクス、例）
3. **目標/ターゲット**: 成功とは何か（具体的、測定可能）
4. **根本原因分析**: なぜ問題が存在するか（なぜなぜ分析または特性要因図を使用）
5. **対策**: 根本原因に対処する提案解決策
6. **実施計画**: 誰が、何を、いつ、どのように
7. **フォローアップ**: 成功を検証し再発を防止する方法

## A3テンプレート

```
═══════════════════════════════════════════════════════════════
                    A3 問題分析
═══════════════════════════════════════════════════════════════

タイトル: [簡潔な問題記述]
担当者: [責任者]
日付: [YYYY-MM-DD]

┌─────────────────────────────────────────────────────────────┐
│ 1. 背景（なぜ重要か）                                        │
├─────────────────────────────────────────────────────────────┤
│ [コンテキスト、インパクト、緊急性、影響を受ける人]            │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 2. 現状（何が起きているか）                                  │
├─────────────────────────────────────────────────────────────┤
│ [事実、データ、メトリクス、例 - 意見ではなく]                │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 3. 目標/ターゲット（成功とは何か）                           │
├─────────────────────────────────────────────────────────────┤
│ [具体的、測定可能、期限付きの目標]                           │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 4. 根本原因分析（なぜ問題が存在するか）                      │
├─────────────────────────────────────────────────────────────┤
│ [なぜなぜ分析、特性要因図、データ分析]                       │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 5. 対策（根本原因に対処する解決策）                          │
├─────────────────────────────────────────────────────────────┤
│ [曖昧な意図ではなく具体的なアクション]                       │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 6. 実施計画（誰が、何を、いつ）                              │
├─────────────────────────────────────────────────────────────┤
│ [タイムライン、責任、依存関係、マイルストーン]               │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 7. フォローアップ（検証と予防）                              │
├─────────────────────────────────────────────────────────────┤
│ [成功メトリクス、監視計画、レビュー日]                       │
└─────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════
```

## 例

### 例1: データベース接続プール枯渇

```
═══════════════════════════════════════════════════════════════
                    A3 問題分析
═══════════════════════════════════════════════════════════════

タイトル: 接続プール枯渇によるAPIダウンタイム
担当者: バックエンドチームリード
日付: 2024-11-14

┌─────────────────────────────────────────────────────────────┐
│ 1. 背景                                                      │
├─────────────────────────────────────────────────────────────┤
│ • APIがピーク時に週2-3回ダウン                               │
│ • 10,000人以上のユーザーに影響、平均15分のダウンタイム       │
│ • 収益インパクト: インシデントあたり約$5K                    │
│ • 顧客満足度スコアが4.5から3.8に低下                         │
│ • トラフィックが40%増加した3週間前から発生                   │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 2. 現状                                                      │
├─────────────────────────────────────────────────────────────┤
│ 観察:                                                        │
│ • 接続プールサイズ: 10（ローンチ以来変更なし）               │
│ • ピーク同時ユーザー: 500（3週間前は300）                    │
│ • 平均リクエスト時間: 200ms（150msだった）                   │
│ • 接続リーク: 約2/時間（解放されない）                       │
│ • エラー: ログに「Connection pool exhausted」                │
│                                                              │
│ パターン:                                                    │
│ • 毎日14時-16時に発生（ピークトラフィック）                  │
│ • 30分かけて徐々に劣化                                       │
│ • 回復にはアプリ再起動が必要                                 │
│ • 長時間実行クエリがプールをブロック（30秒以上のものも）     │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 3. 目標/ターゲット                                           │
├─────────────────────────────────────────────────────────────┤
│ • 接続枯渇によるダウンタイムゼロ                             │
│ • 1000同時ユーザーをサポート（現在のピークの2倍）            │
│ • すべての接続が5秒以内に解放                                │
│ • 1週間以内に達成                                            │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 4. 根本原因分析                                              │
├─────────────────────────────────────────────────────────────┤
│ なぜなぜ分析:                                                │
│ 問題: 接続プール枯渇                                         │
│ なぜ1: 10個すべての接続が使用中、利用可能なものがない        │
│ なぜ2: リクエスト後に接続が解放されない                      │
│ なぜ3: エラー処理が接続を閉じない                            │
│ なぜ4: try-catchブロックに.finally()がない                   │
│ なぜ5: リソースクリーンアップのコードレビューチェックリストがない │
│                                                              │
│ 寄与要因:                                                    │
│ • 現在の負荷に対してプールサイズが小さすぎる                 │
│ • 接続タイムアウトが設定されていない（永遠にハング）         │
│ • 遅いクエリが接続を長く保持                                 │
│ • プールメトリクスの監視/アラートがない                      │
│                                                              │
│ 根本原因: リソースクリーンアップの体系的な問題 +             │
│           プールサイジング不足                                │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 5. 対策                                                      │
├─────────────────────────────────────────────────────────────┤
│ 即時（今週）:                                                │
│ 1. すべてのDBコードを監査、接続解放用に.finally()を追加      │
│ 2. プールサイズ増加: 10 → 30                                 │
│ 3. 接続タイムアウト追加: 10秒                                │
│ 4. プール監視とアラート追加（>80%使用時）                    │
│                                                              │
│ 短期（2週間）:                                               │
│ 5. 遅いクエリを最適化（インデックス追加）                    │
│ 6. 接続プールのベストプラクティスドキュメント作成            │
│ 7. 接続リーク用の自動テスト追加                              │
│                                                              │
│ 長期（1ヶ月）:                                               │
│ 8. 自動解放機能付き接続プールライブラリに移行                │
│ 9. .finally()欠落を検出するリンタールール追加                │
│ 10. リソース管理用のPRチェックリスト作成                     │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 6. 実施計画                                                  │
├─────────────────────────────────────────────────────────────┤
│ 週1（11/14-18）:                                             │
│ • 1-2日目: 接続リークの監査と修正 [開発チーム]               │
│ • 2日目: プールサイズ増加、タイムアウト追加 [DevOps]         │
│ • 3日目: 監視セットアップ [SRE]                              │
│ • 4日目: 負荷テスト [QA]                                     │
│ • 5日目: 本番デプロイ [DevOps]                               │
│                                                              │
│ 週2（11/21-25）:                                             │
│ • 特定された遅いクエリを最適化 [DBチーム]                    │
│ • ベストプラクティスドキュメント作成 [テックライター + 開発リード] │
│ • 接続リークテスト作成 [QAチーム]                            │
│                                                              │
│ 週3-4（11/28 - 12/9）:                                       │
│ • 接続プールライブラリ評価 [開発チーム]                      │
│ • リンタールール追加 [開発リード]                            │
│ • PRテンプレート更新 [開発リード]                            │
│                                                              │
│ 依存関係: 週1の修正をブロックするものなし                    │
│ リソース: 開発者2名、DevOps 1名、SRE 1名                     │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 7. フォローアップ                                            │
├─────────────────────────────────────────────────────────────┤
│ 成功メトリクス:                                              │
│ • ダウンタイムインシデントゼロ（4週間監視）                  │
│ • ピーク時のプール使用率<80%                                 │
│ • 接続リーク検出なし                                         │
│ • レスポンスタイム<200ms p95                                 │
│                                                              │
│ 監視:                                                        │
│ • 毎日: プール使用ダッシュボード確認                         │
│ • 毎週: 接続リークアラートレビュー                           │
│ • 隔週: チーム振り返りで進捗確認                             │
│                                                              │
│ レビュー日:                                                  │
│ • 週1（11/18）: 即時修正の効果を確認                         │
│ • 週2（11/25）: 最適化のインパクト評価                       │
│ • 週4（12/9）: 最終レビュー、A3クローズ                      │
│                                                              │
│ 予防:                                                        │
│ • オンボーディングに接続処理を追加                           │
│ • リソース管理コードの月次監査                               │
│ • SREランブックにプールメトリクスを含める                    │
└─────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════
```

### 例2: 本番環境のセキュリティ脆弱性

```
═══════════════════════════════════════════════════════════════
                    A3 問題分析
═══════════════════════════════════════════════════════════════

タイトル: 重大なSQLインジェクション脆弱性
担当者: セキュリティチームリード
日付: 2024-11-14

┌─────────────────────────────────────────────────────────────┐
│ 1. 背景                                                      │
├─────────────────────────────────────────────────────────────┤
│ • 研究者から重大なセキュリティ脆弱性の報告                   │
│ • ユーザー検索エンドポイントにSQLインジェクション            │
│ • 100K以上のユーザーレコードに影響する潜在的データ漏洩       │
│ • CVSSスコア: 9.8（重大）                                    │
│ • 脆弱性が6ヶ月間本番環境に存在                              │
│ • 同様の問題が他2つのエンドポイントで発見（スキャン中）      │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 2. 現状                                                      │
├─────────────────────────────────────────────────────────────┤
│ 脆弱なコード:                                                │
│ • /api/users/searchエンドポイントが文字列連結を使用          │
│ • 入力: 検索クエリ（ユーザー提供、サニタイズなし）           │
│ • パターン: `SELECT * FROM users WHERE name = '${input}'`    │
│                                                              │
│ スコープ:                                                    │
│ • 3つのエンドポイントが脆弱（search, filter, export）        │
│ • すべて同じ安全でないパターンを使用                         │
│ • パラメータ化クエリなし                                     │
│ • 入力バリデーション層なし                                   │
│                                                              │
│ リスク評価:                                                  │
│ • 公開インターネットから悪用可能                             │
│ • 悪用の証拠なし（ログ確認済み）                             │
│ • 管理パネルに類似コード（より高い権限）                     │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 3. 目標/ターゲット                                           │
├─────────────────────────────────────────────────────────────┤
│ • 24時間以内にすべてのSQLインジェクション脆弱性をパッチ      │
│ • コードベースにSQLインジェクション脆弱性ゼロ                │
│ • 将来のコードで同様の問題を防止                             │
│ • 不正アクセスがなかったことを確認                           │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 4. 根本原因分析                                              │
├─────────────────────────────────────────────────────────────┤
│ なぜなぜ分析:                                                │
│ 問題: 本番環境にSQLインジェクション脆弱性                    │
│ なぜ1: ユーザー入力がSQLに直接連結                           │
│ なぜ2: 開発者がSQLインジェクションリスクを認識していなかった │
│ なぜ3: 新しい開発者向けのセキュリティトレーニングがない      │
│ なぜ4: セキュリティがオンボーディングチェックリストにない    │
│ なぜ5: セキュリティチームが開発プロセスに関与していない      │
│                                                              │
│ 寄与要因（特性要因図）:                                      │
│ • プロセス: セキュリティコードレビューがない                 │
│ • 技術: ORMが一貫して使用されていない                        │
│ • 人: セキュアコーディングの知識ギャップ                     │
│ • 方法: CI/CDにSASTツールがない                              │
│                                                              │
│ 根本原因: セキュリティが開発プロセスに統合されていない、     │
│           トレーニングギャップ                                │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 5. 対策                                                      │
├─────────────────────────────────────────────────────────────┤
│ 即時（24時間）:                                              │
│ 1. 3つの脆弱なエンドポイントすべてをパッチ                   │
│ 2. 本番環境にホットフィックスをデプロイ                      │
│ 3. コードベースを同様のパターンでスキャン                    │
│ 4. 悪用の試みがないかアクセスログをレビュー                  │
│                                                              │
│ 短期（1週間）:                                               │
│ 5. すべての生SQLをパラメータ化クエリに置き換え               │
│ 6. 入力バリデーションミドルウェアを追加                      │
│ 7. CIにSASTツールをセットアップ（Snyk/SonarQube）            │
│ 8. すべてのデータアクセスコードをセキュリティチームがレビュー │
│                                                              │
│ 長期（1ヶ月）:                                               │
│ 9. すべての開発者に必須のセキュリティトレーニング            │
│ 10. PRプロセスにセキュリティレビューを追加                   │
│ 11. すべてのデータベースアクセスをORMに移行                  │
│ 12. セキュリティチャンピオンプログラムを実施                 │
│ 13. 四半期ごとのセキュリティ監査                             │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 6. 実施計画                                                  │
├─────────────────────────────────────────────────────────────┤
│ 0-4時間目（緊急対応）:                                       │
│ • パッチ作成とテスト [セキュリティ + シニア開発]             │
│ • 緊急PRレビュー [CTO + テックリード]                        │
│ • ステージングにデプロイ [DevOps]                            │
│                                                              │
│ 4-24時間目（本番デプロイ）:                                  │
│ • ホットフィックスをデプロイ [DevOps + オンコール]           │
│ • 問題を監視 [SREチーム]                                     │
│ • 悪用がないかログをスキャン [セキュリティチーム]            │
│ • ステークホルダーに通知 [セキュリティリード + CEO]          │
│                                                              │
│ 2-7日目:                                                     │
│ • コードベース全体の修正 [開発チーム]                        │
│ • SASTツールセットアップ [DevOps + セキュリティ]             │
│ • セキュリティレビュー [外部監査員]                          │
│                                                              │
│ 2-4週目:                                                     │
│ • セキュリティトレーニングプログラム [セキュリティ + HR]     │
│ • プロセス改善 [エンジニアリングリーダーシップ]              │
│                                                              │
│ 依存関係: 外部監査員の可用性（週2）                          │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 7. フォローアップ                                            │
├─────────────────────────────────────────────────────────────┤
│ 成功メトリクス:                                              │
│ • SQLインジェクション脆弱性ゼロ（スキャンで確認）            │
│ • PRの100%がSASTチェックを通過                               │
│ • 開発者のセキュリティトレーニング完了率100%                 │
│ • ログ分析で不正アクセス検出なし                             │
│                                                              │
│ 検証:                                                        │
│ • 1日目: パッチデプロイ確認、脆弱性クローズ                  │
│ • 週1: 外部セキュリティ監査で修正確認                        │
│ • 週2: SASTツールが同様の問題を検出                          │
│ • 月1: トレーニング完了、プロセス採用                        │
│                                                              │
│ 予防:                                                        │
│ • SASTツールがCIで脆弱なコードをブロック                     │
│ • データアクセスコードにセキュリティレビュー必須             │
│ • 四半期ペネトレーションテスト                               │
│ • 年次セキュリティトレーニングリフレッシュ                   │
│                                                              │
│ インシデントレポート:                                        │
│ • ポストモーテム会議: 11/16                                  │
│ • 学んだ教訓を文書化                                         │
│ • エンジニアリング組織と共有                                 │
└─────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════
```

## 注意事項

- A3は簡潔で完全な思考を強制（1ページに収まる）
- 意見や非難ではなく、データと事実を使用
- 根本原因分析が重要—`/why`または`/cause-and-effect`を使用
- 対策は症状ではなく根本原因に対処する必要がある
- 実施計画には明確なオーナーシップとタイムラインが必要
- フォローアップで持続可能な改善を確保
- A3は組織学習のための歴史的記録となる
- 状況が進展したらA3を更新（クローズするまで生きたドキュメント）
- A3を検討: インシデント、繰り返し発生する問題、大きな改善
- A3は過剰: 小さなバグ、1行の修正、些細な問題
