---
description: Iterative Five Whys root cause analysis drilling from symptoms to fundamentals
argument-hint: 分析する問題や症状の説明（オプション）
---

# なぜなぜ分析（Five Whys）

「なぜ」を繰り返し問いかけることで、表面的な症状から根本原因を掘り下げる分析手法。

## 説明

「なぜ」を繰り返し問いかけ、表面的な症状から本質的な原因へと掘り下げる。その場しのぎの修正ではなく、システム的な問題を特定する。

## 使用方法

`/why [問題の説明]`

## 変数

- ISSUE: 分析する問題または症状（デフォルト: 入力を促す）
- DEPTH: 「なぜ」の繰り返し回数（デフォルト: 5、必要に応じて調整）

## 手順

1. 問題を明確に述べる
2. 「なぜこれが起きたか？」を問い、答えを記録
3. その答えに対して再度「なぜ？」を問う
4. 根本原因に到達するまで続ける（通常5回の繰り返し）
5. 逆方向に検証: 根本原因 → 症状
6. 複数の原因が出現した場合は分岐を探索
7. 症状ではなく根本原因に対処する解決策を提案

## 例

### 例1: 本番環境のバグ

```
問題: ユーザーがチェックアウトで500エラーを見る
なぜ1: 決済サービスが例外をスロー
なぜ2: リクエストが30秒後にタイムアウト
なぜ3: データベースクエリに45秒かかる
なぜ4: transactionsテーブルにインデックスがない
なぜ5: インデックス作成がマイグレーションスクリプトになかった
根本原因: マイグレーションレビュープロセスがクエリパフォーマンスをチェックしていない

解決策: マイグレーションPRテンプレートにクエリパフォーマンスチェックを追加
```

### 例2: CI/CDパイプラインの失敗

```
問題: E2Eテストが断続的に失敗
なぜ1: 非同期テストセットアップで競合状態
なぜ2: テストがデータベースシード完了を待っていない
なぜ3: シード関数がPromiseを返していない
なぜ4: TypeScriptが戻り値の型の欠落を検出しなかった
なぜ5: テスト設定でstrictモードが有効になっていない
根本原因: srcとtests間でTypeScript設定が不統一

解決策: TypeScript設定を統一し、すべてでstrictモードを有効化
```

### 例3: 複数分岐の分析

```
問題: 機能デプロイに2時間かかる

分岐A（ビルド）:
なぜ1: Dockerビルドに90分かかる
なぜ2: レイヤーキャッシングがない
なぜ3: 依存関係が毎回再インストールされる
なぜ4: Dockerfileのタイムスタンプでキャッシュが無効化される
根本原因A: Dockerfileがバージョニングに現在のタイムスタンプを使用

分岐B（テスト）:
なぜ1: テストスイートに30分かかる
なぜ2: 統合テストが順次実行される
なぜ3: テストランナー設定がmaxWorkers: 1
なぜ4: 以前の開発者がフレーキーテストのため並列実行を無効化
根本原因B: フレーキーテストが並列実行の無効化で隠蔽されている

解決策:
A) Dockerfileからタイムスタンプを削除し、git SHAを使用
B) フレーキーテストを修正し、並列テスト実行を再有効化
```

## 注意事項

- 症状で止まらない—システム的な問題を探り続ける
- 複数の根本原因が存在する可能性—異なる分岐を探索
- 将来の参照のために各「なぜ」を記録
- 技術的原因とプロセス関連の原因の両方を考慮
- 魔法は正確に5回の「なぜ」にあるのではない—真の根本原因に到達したら止める
- システム的/プロセス的な問題にぶつかったら止める、技術的な詳細だけでなく
- 複数の根本原因は一般的—分岐を個別に探索
- 「人為的ミス」が出現したら、さらに掘り下げる: なぜミスが可能だったか？
- 将来の参照のためにすべての「なぜ」を記録
- 根本原因は通常以下を含む: バリデーションの欠如、ドキュメントの欠如、不明確なプロセス、自動化の欠如
- 解決策をテスト: 実装 → 症状の解消を確認 → 再発を監視
