---
name: deepening-plan
description: |
  計画の各セクションに対して並列リサーチエージェントを投入し、計画を深掘り・強化する。
  Phase 2（計画）で30_plan.md作成後、サブエージェントレビュー前に**自動的に**使用する。
  「計画を深掘りして」「deepen planして」「計画をリサーチで補強して」等の依頼にも対応。
  小規模変更（1-2ファイル）・自明な修正の場合はスキップ可。
---

# Deepening Plan

既存の計画（30_plan.md）の各セクションに対して並列リサーチを実行し、
具体性・正確性・網羅性を強化する。

## パイプライン上の位置

```
Phase 2: 計画作成 → **deepening-plan** → サブエージェントレビュー（規模別ラウンド） → User Validation Gate
```

- **入力**: 30_plan.md（実装計画）、solutions/の過去知見
- **出力**: 強化された30_plan.md（リサーチ結果・リスク・参考情報を追記）
- **後続**: サブエージェントレビューが計画の品質を検証

## 前提条件

- 30_plan.md（実装計画）が作成済みであること
- 計画にタスクが定義されていること

## 実行フロー

### Step 1: 計画の解析

30_plan.mdを読み取り、各タスクの以下を特定:
- 使用するライブラリ/フレームワーク
- 変更対象の技術領域
- 不確実性が高いポイント
- 外部依存（API, DB, 外部サービス等）

### Step 2: リサーチエージェント並列起動

タスクの技術領域に応じて、以下のリサーチを**並列**で実行:

#### ライブラリ/フレームワーク調査（Context7）
```
対象ライブラリのAPIドキュメントを確認:
- 使用予定のAPIが最新バージョンで有効か
- deprecated APIを使っていないか
- より適切なAPIがないか
- 公式の推奨パターンは何か
```

#### アーキテクチャ調査（deepwiki）
```
関連リポジトリの設計パターンを調査:
- 類似機能の実装例
- 推奨されるアーキテクチャパターン
- 既知の落とし穴
```

#### 一般情報調査（WebSearch）
```
計画に関連する最新情報を検索:
- ベストプラクティス
- パフォーマンスの注意点
- セキュリティ上の考慮事項
- コミュニティでの議論
```

#### 過去知見調査（learnings-researcher）
```
solutions/とmemories/から類似の過去解決策を検索:
- 同じ技術スタックでの過去の問題
- 関連するアーキテクチャ決定
- 過去に踏んだ落とし穴
```

### Step 3: 計画の強化

リサーチ結果を元に30_plan.mdを更新:

1. **具体性の向上**: 抽象的な記述を具体的なAPI名・メソッド名に置換
2. **リスクの追加**: リサーチで判明した落とし穴・注意点を追記
3. **代替案の記載**: より良いアプローチが見つかった場合に記載
4. **参考情報の追加**: 各タスクに関連ドキュメントのリンクを追記

### Step 4: 変更サマリー

計画に対して行った変更を05_log.mdに記録:
- 追加した情報
- 変更した方針（理由付き）
- 発見したリスク

## 並列実行の方針

- 各タスクのリサーチは**タスクごとに独立**しているため並列実行可能
- ただし1タスク内の複数リサーチも並列可（Context7 + WebSearch + deepwiki）
- learnings-researcherの結果は他のリサーチに依存しないため常に並列

## 注意事項

- 計画の根本的な方向性は変えない（それはレビューアーの役割）
- リサーチで見つけた情報は出典を明記する
- 不確実な情報は「要確認」として明示する
- 計画のdeepen後にサブエージェントレビューが控えているため、
  リサーチに集中し、レビュー的な指摘はしない
