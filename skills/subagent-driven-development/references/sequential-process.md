# 逐次実行プロセス

タスクまたは問題ごとに1つのエージェントをディスパッチし、逐次的に作業させ、各タスクまたは問題の後に出力とコードをレビューする。

## 1. 計画のロード

計画ファイルを読み、すべてのタスクでTodoWriteを作成する。

## 2. サブエージェントでタスクを実行

各タスクについて:

**新しいサブエージェントをディスパッチ:**

```
Task tool (general-purpose):
  description: "タスクNを実装: [タスク名]"
  prompt: |
    あなたは[plan-file]のタスクNを実装しています。

    そのタスクを注意深く読んでください。あなたの仕事は:
    1. タスクが指定する内容を正確に実装する
    2. テストを書く（タスクがTDDを指示している場合はそれに従う）
    3. 実装が動作することを確認する
    4. 作業をコミットする
    5. 報告する

    作業ディレクトリ: [directory]

    報告内容: 実装したこと、テストしたこと、テスト結果、変更したファイル、問題点
```

**サブエージェントが報告** 作業のサマリーを返す。

## 3. サブエージェントの作業をレビュー

**コードレビュアーサブエージェントをディスパッチ:**

```
Task tool (superpowers:code-reviewer):
  requesting-code-review/code-reviewer.mdのテンプレートを使用

  WHAT_WAS_IMPLEMENTED: [サブエージェントの報告から]
  PLAN_OR_REQUIREMENTS: [plan-file]のタスクN
  BASE_SHA: [タスク前のコミット]
  HEAD_SHA: [現在のコミット]
  DESCRIPTION: [タスクのサマリー]
```

**コードレビュアーが返す:** 強み、問題点（Critical/Important/Minor）、評価

## 4. レビューフィードバックを適用

**問題が見つかった場合:**

- Critical問題は即座に修正
- Important問題は次のタスク前に修正
- Minor問題はメモしておく

**必要に応じてフォローアップサブエージェントをディスパッチ:**

```
"コードレビューからの問題を修正: [問題のリスト]"
```

## 5. 完了マーク、次のタスクへ

- TodoWriteでタスクを完了としてマーク
- 次のタスクへ移動
- ステップ2-5を繰り返す

## 6. 最終レビュー

すべてのタスク完了後、最終コードレビュアーをディスパッチ:

- 実装全体をレビュー
- すべての計画要件が満たされているか確認
- 全体のアーキテクチャを検証

## 7. 開発完了

最終レビュー合格後:

- 宣言: 「finishing-a-development-branchスキルを使用してこの作業を完了します。」
- **必須サブスキル:** superpowers:finishing-a-development-branchを使用
- そのスキルに従ってテストを検証し、オプションを提示し、選択を実行

## ワークフロー例

```
あなた: この計画を実行するためにサブエージェント駆動開発を使用します。

[計画をロード、TodoWriteを作成]

タスク1: フックインストールスクリプト

[実装サブエージェントをディスパッチ]
サブエージェント: テスト付きでinstall-hookを実装、5/5パス

[git SHAを取得、コードレビュアーをディスパッチ]
レビュアー: 強み: 良いテストカバレッジ。問題: なし。準備完了。

[タスク1を完了としてマーク]

タスク2: リカバリモード

[実装サブエージェントをディスパッチ]
サブエージェント: verify/repairを追加、8/8テストパス

[コードレビュアーをディスパッチ]
レビュアー: 強み: 堅実。問題(Important): 進捗レポートが欠落

[修正サブエージェントをディスパッチ]
修正サブエージェント: 100会話ごとに進捗を追加

[修正を確認、タスク2を完了としてマーク]

...

[すべてのタスク後]
[最終コードレビュアーをディスパッチ]
最終レビュアー: すべての要件が満たされました、マージ準備完了

完了！
```

## 警告サイン

**絶対にしてはいけないこと:**

- タスク間のコードレビューをスキップ
- 未修正のCritical問題がある状態で進む
- 複数の実装サブエージェントを並列でディスパッチ（競合の原因）
- 計画タスクを読まずに実装

**サブエージェントがタスクに失敗した場合:**

- 具体的な指示付きで修正サブエージェントをディスパッチ
- 手動で修正しようとしない（コンテキスト汚染）
