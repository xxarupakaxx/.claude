---
name: pr-review
description: PRレビュー。PR番号・ブランチ名指定時またはレビュー依頼時に使用。現在のセッションとClaude Code別セッションによるマルチ視点レビューでCritical/High/Medium分類の指摘を報告。
---

# PRレビュー

## トリガー条件

- PRレビューを依頼された場合
- PR番号またはブランチ名が指定された場合

## 実行手順

### 1. PR情報の取得

```bash
# PR詳細を取得
gh pr view <番号> --json title,body,author,headRefName,baseRefName,files

# diffを取得
gh pr diff <番号> > /tmp/pr-<番号>.diff
```

### 2. PJルールの確認

CLAUDE.mdを読み、以下を把握:
- アーキテクチャルール
- 命名規則
- コーディング規約

### 3. Claude Codeによるレビュー

変更された各ファイルについて:
1. Readツールでファイル全体を読む（diffだけでなく）
2. 既存パターンとの整合性を確認
3. 問題点を特定

### 4. Claude Code別セッションによるレビュー

現在のセッションとは独立した別セッションでレビューを実行し、異なる視点からの指摘を得る。

**利点:**
- 現在のセッションのコンテキストに影響されない客観的なレビュー
- 同じモデルでも別視点からの分析が可能

```bash
claude -p "以下のPRをレビューしてください:

## レビュー観点
- コードの品質（バグ、セキュリティ、パフォーマンス）
- 設計の妥当性
- テストの十分性
- ドキュメントの必要性

## 出力形式
問題を Critical/High/Medium/Good に分類して報告してください。
指摘がなければ「指摘なし」とだけ回答してください。

## PR情報
タイトル: <タイトル>
ブランチ: <ブランチ> → <ベース>

## 変更内容
$(cat /tmp/pr-<番号>.diff)" --output-format json
```

**出力の確認:**
```bash
# 結果はJSON形式で返される
# result フィールドにレビュー内容が含まれる
```

### 5. 結果の統合

現在のセッションと別セッションの両方の指摘を統合し、以下の形式でレポート:

```markdown
# PRレビュー: #<番号>

## 対象
- PR: #<番号> - <タイトル>
- ブランチ: <ブランチ> → <ベース>

## 現在のセッションによる指摘

### Critical
- [指摘内容]

### High
- [指摘内容]

### Medium
- [指摘内容]

## 別セッションによる指摘

### Critical
- [指摘内容]

### High
- [指摘内容]

### Medium
- [指摘内容]

## 統合サマリ

| 観点 | 現在セッション | 別セッション | 統合判断 |
|------|--------------|-------------|---------|
| セキュリティ | OK | OK | OK |
| パフォーマンス | 指摘あり | OK | 要確認 |
| 設計 | OK | 指摘あり | 要確認 |
| テスト | OK | OK | OK |

## 推奨アクション
1. [Critical/Highの指摘への対応]
2. [Mediumの指摘への対応（任意）]

## マージ推奨: [Yes/No/条件付き]
```

## 問題の分類

| 分類 | 説明 | 対応 |
|-----|------|------|
| Critical | バグ、セキュリティ、破壊的変更 | マージ前に必須修正 |
| High | アーキテクチャ違反、テスト不足 | 強く推奨 |
| Medium | 命名、コメント | 改善推奨 |
| Good | 良い実装 | 賞賛 |
