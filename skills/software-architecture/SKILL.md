---
name: software-architecture
description: 品質重視のソフトウェアアーキテクチャガイド。コード作成、アーキテクチャ設計、コード分析など、ソフトウェア開発に関連するすべての場面で使用すべきスキル。
---

# ソフトウェアアーキテクチャ開発スキル

このスキルは、品質重視のソフトウェア開発とアーキテクチャのガイダンスを提供します。Clean ArchitectureとDomain Driven Design（DDD）の原則に基づいています。

## コードスタイルルール

### 一般原則

- **早期リターンパターン**: 可読性向上のため、ネストした条件分岐よりも早期リターンを常に使用する
- 再利用可能な関数やモジュールを作成し、コードの重複を避ける
- 長いコンポーネントや関数（80行以上）は、複数の小さなコンポーネントや関数に分解する。他で使用できない場合は同一ファイル内に保持する。ただし、ファイルが200行を超える場合は複数ファイルに分割すべき
- 可能な限り関数宣言よりもアロー関数を使用する

### ベストプラクティス

#### ライブラリファーストアプローチ

- **カスタムコードを書く前に、必ず既存のソリューションを検索する**
  - **Context7で最新のライブラリドキュメントを確認**（バージョン固有のAPI、非推奨警告等）
  - 問題を解決する既存ライブラリをnpmで確認
  - 既存のサービス/SaaSソリューションを評価
  - 一般的な機能にはサードパーティAPIを検討
- 独自のutilsやhelpersを書く代わりにライブラリを使用する。例えば、独自のリトライロジックを書く代わりに`cockatiel`を使用する
- **Context7活用例**: `resolve-library-id` → `query-docs` で最新ドキュメント取得
- **カスタムコードが正当化される場合:**
  - ドメイン固有のビジネスロジック
  - 特別な要件を持つパフォーマンスクリティカルなパス
  - 外部依存が過剰になる場合
  - 完全な制御が必要なセキュリティに敏感なコード
  - 十分な評価の結果、既存ソリューションが要件を満たさない場合

#### アーキテクチャと設計

- **Clean Architecture & DDD原則:**
  - ドメイン駆動設計とユビキタス言語に従う
  - ドメインエンティティをインフラストラクチャの関心事から分離
  - ビジネスロジックをフレームワークから独立させる
  - ユースケースを明確に定義し、分離を維持
- **命名規則:**
  - **避けるべき** 汎用的な名前: `utils`, `helpers`, `common`, `shared`
  - **使用すべき** ドメイン固有の名前: `OrderCalculator`, `UserAuthenticator`, `InvoiceGenerator`
  - 境界づけられたコンテキストの命名パターンに従う
  - 各モジュールは単一の明確な目的を持つべき
- **関心の分離:**
  - ビジネスロジックとUIコンポーネントを混在させない
  - データベースクエリをコントローラから分離
  - コンテキスト間の明確な境界を維持
  - 責務の適切な分離を確保

#### 避けるべきアンチパターン

- **NIH（Not Invented Here）症候群:**
  - Auth0/Supabaseが存在するのにカスタム認証を構築しない
  - Redux/Zustandを使用せずにカスタム状態管理を書かない
  - 確立されたライブラリの代わりにカスタムフォームバリデーションを作成しない
- **不適切なアーキテクチャの選択:**
  - ビジネスロジックとUIコンポーネントの混在
  - コントローラ内での直接的なデータベースクエリ
  - 明確な関心の分離の欠如
- **汎用的な命名のアンチパターン:**
  - 50個の無関係な関数を含む`utils.js`
  - ゴミ箱と化した`helpers/misc.js`
  - 目的が不明確な`common/shared.js`
- 覚えておくこと: カスタムコードの全ての行は、メンテナンス、テスト、ドキュメントが必要な負債である

#### コード品質

- 型付きcatchブロックによる適切なエラーハンドリング
- 複雑なロジックを小さく再利用可能な関数に分解
- 深いネストを避ける（最大3レベル）
- 可能な限り関数は50行以内に抑える
- 可能な限りファイルは200行以内に抑える
