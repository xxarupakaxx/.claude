---
name: update-inst
description: user-level指示の更新。Claudeが間違いを犯した際に、再発防止のためCLAUDE.md/context/を更新。`/update-inst <間違えた内容>` で使用。
model: opus
allowed-tools: Read, Write, Glob, Grep
---

# 指示更新スキル

## 概要

Claudeが間違いを犯した際、その原因を分析し、再発防止のためuser-level CLAUDE.mdや関連ファイルを更新する。

## トリガー条件

- `/update-inst <間違えた内容>` が実行された場合
- Claudeが指示に反した行動をした際に、ユーザーが再発防止を依頼した場合

## 実行手順

### Phase 1: 問題分析

1. **間違いの特定**
   - 何が間違っていたか
   - どこで間違いが発生したか（どのPhase、どの処理）

2. **原因の特定**
   - 指示が不明確だったか
   - 例示が誤解を招いたか
   - 指示が存在しなかったか
   - 優先度が不明確だったか

3. **関連ファイルの特定**

| ファイル | 確認観点 |
|---------|---------|
| `~/.claude/CLAUDE.md` | 全PJ共通の作業フロー、基本ルール |
| `~/.claude/context/*.md` | 詳細ルール、フォーマット定義 |
| `~/.claude/skills/*/SKILL.md` | スキル固有のルール |

### Phase 2: 修正方針の決定

1. **修正タイプの判断**

| タイプ | 対応 | 例 |
|-------|------|-----|
| 指示の追加 | 新しいルールを追記 | 「〇〇の場合は△△すること」 |
| 指示の明確化 | 曖昧な表現を具体化 | 「yymmdd」→「システムプロンプトのToday's dateから取得」 |
| 例示の修正 | 誤解を招く例を修正 | 固定値の例示→動的な説明 |
| 優先度の明示 | IMPORTANT/CRITICALの追加 | 重要な指示の強調 |

2. **修正対象の決定**

- user-level（全PJ共通）か、PJ-level（特定PJのみ）かを判断
- 最小限の修正で最大の効果を狙う
- 既存の指示との整合性を確認

### Phase 3: 修正の実施

1. **修正前の状態を記録**
   - 変更するファイルと箇所
   - 変更前の内容

2. **修正を提案**

```markdown
## 修正提案

### ファイル: <パス>

**変更前:**
```
<現在の内容>
```

**変更後:**
```
<修正後の内容>
```

**理由:** <なぜこの修正が必要か>
```

3. **ユーザーの承認を得る**
   - AskUserQuestionで確認
   - 必要に応じて修正案を調整

4. **修正を適用**

### Phase 4: 検証

1. **整合性の確認**
   - 他の指示と矛盾がないか
   - 過度に制限的でないか

2. **今回の間違いが防げるか確認**
   - 修正後の指示で、同じ間違いが発生しないか
   - エッジケースも考慮

## 修正のベストプラクティス

### 1. 60行ルールを維持
- CLAUDE.mdは60行以下に収める
- 詳細は`@`参照でcontext/に委譲

### 2. 強調表現の適切な使用
- **IMPORTANT**: 重要だが例外あり
- **CRITICAL**: 絶対に従うべき
- **YOU MUST**: 強制

### 3. 例示の注意点
- 固定値（日付、ID等）を例示に使わない
- 「システムプロンプトから取得」等の動的な説明を使う
- 例示が誤解を招かないか確認

### 4. 禁止事項リストの活用
- 繰り返し発生する間違いは「禁止事項」セクションに追加
- 簡潔に記載（理由は別ファイルに）

## 出力フォーマット

```markdown
# 指示更新レポート

## 問題
- 間違い: <何が間違っていたか>
- 原因: <なぜ間違いが発生したか>

## 修正内容

### 1. <ファイルパス>
- 修正タイプ: <追加/明確化/例示修正/優先度明示>
- 変更内容: <概要>

## 検証
- 同じ間違いが防げるか: <Yes/No + 理由>
- 整合性: <問題なし/要注意点>

## 適用状態
- [ ] ユーザー承認済み
- [ ] 修正適用済み
```
