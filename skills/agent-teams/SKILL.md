---
name: agent-teams
description: Agent Teams機能を活用した大規模タスク実行。複数の独立したClaude Codeインスタンスが協調動作し、並列で複雑なタスクを処理。
---

# Agent Teams

## 概要

Agent Teams機能を活用し、複数の独立したClaude Codeインスタンスが協調してタスクを実行する。
サブエージェント（Taskツール）とは異なり、各インスタンスは完全に独立して動作し、直接通信が可能。

## トリガー条件

- ユーザーが `/agent-teams` を実行した場合
- 大規模なリファクタリングを依頼された場合
- 複数の独立したモジュールを同時に実装する場合
- 並列探索で価値が生まれるタスクの場合

## Agent Teams vs サブエージェント（Task）

| 観点 | Agent Teams | サブエージェント（Task） |
|------|------------|----------------------|
| 実行環境 | 独立したClaude Codeインスタンス | 同一セッション内 |
| コンテキスト | 各インスタンスが独自のコンテキスト | 親エージェントのコンテキストを共有 |
| 通信 | インスタンス間で直接通信可能 | 親エージェントに結果を返すのみ |
| コスト | 5人チームなら約5倍 | 通常のAPI呼び出し |
| 適切な用途 | 大規模・複雑なタスク | 小〜中規模のタスク |

## 使用条件

**事前条件:**
- `CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1` が設定されていること（settings.jsonで確認済み）

**適切な場面:**
- 10個以上の独立したファイル/モジュールの同時変更
- 複数の観点からの並列探索（調査、レビュー等）
- 大規模なマイグレーション作業
- 複雑な機能の並列実装

**不適切な場面:**
- 単一ファイルの変更
- 依存関係が強いタスク（順次実行が必要）
- 小規模なバグ修正
- コスト制約が厳しい場合

## 実行手順

### Phase 0: 準備

1. タスクの分解

```markdown
## タスク分解

### メインタスク
[全体の目標]

### チームメイトに割り当てるタスク
| # | タスク | 担当 | 依存 | 出力 |
|---|-------|------|------|------|
| 1 | タスクA | teammate-1 | - | path/to/output |
| 2 | タスクB | teammate-2 | - | path/to/output |
| 3 | タスクC | teammate-3 | 1,2 | path/to/output |
```

2. 依存関係の確認
   - 完全に独立したタスクはバッチ1として並列実行
   - 依存があるタスクはバッチ2以降で実行

### Phase 1: チーム編成

**リーダー（現在のセッション）の役割:**
- タスクの割り当て
- 進捗の監視
- 結果の統合
- 品質の確認

**チームメイト起動:**

```
Agent Teamsを起動し、以下のタスクを割り当てる:

teammate-1: [タスクA の詳細]
- 目標: ...
- 対象ファイル: ...
- 期待する出力: ...

teammate-2: [タスクB の詳細]
- 目標: ...
- 対象ファイル: ...
- 期待する出力: ...
```

### Phase 2: 並列実行

**リーダーの監視タスク:**
- 各チームメイトの進捗確認
- ブロッカーの解消
- タスク完了の確認

**コミュニケーション:**
- チームメイトはリーダーに進捗を報告
- 問題発生時はリーダーに相談
- 依存タスク完了時は次のバッチを開始

### Phase 3: 結果統合

1. 各チームメイトの成果物を確認
2. 整合性チェック
3. コンフリクト解消
4. 統合テスト実行

### Phase 4: 品質確認

```bash
# 品質チェック（PJ CLAUDE.mdのコマンドを使用）
npm run lint
npm run typecheck
npm run test
```

## 出力形式

```markdown
# Agent Teams 実行レポート

## 概要
- 開始: YYYY-MM-DD HH:MM
- 完了: YYYY-MM-DD HH:MM
- チームサイズ: N人

## タスク完了状況

| # | タスク | 担当 | ステータス | 成果物 |
|---|-------|------|----------|-------|
| 1 | タスクA | teammate-1 | 完了 | path/to/output |
| 2 | タスクB | teammate-2 | 完了 | path/to/output |

## 統合結果

### 変更ファイル
- path/to/file1
- path/to/file2

### コンフリクト解消
- [あれば記載]

### 品質チェック結果
- lint: PASS
- typecheck: PASS
- test: PASS

## 課題・注意事項
- [あれば記載]
```

## 制限事項

**既知の制限:**
- `/resume` や `/rewind` でチームメイトは復元されない
- 1セッションで1チームのみ
- ネストしたチーム（チームメイトがチームを持つ）は不可
- タスク完了ステータスが遅れる場合がある

**対処法:**
- セッション再開時は新しいチームメイトを起動
- タスクが止まっている場合は手動で完了マーク
- 複雑な階層構造が必要な場合はサブエージェントと組み合わせ

## コスト考慮

```
チームサイズ N人 = 約 N倍 のトークン消費

推奨:
- 小規模タスク（1-3ファイル）: サブエージェント使用
- 中規模タスク（4-10ファイル）: サブエージェント並列
- 大規模タスク（10+ファイル）: Agent Teams検討
```

## 使用例

### 例1: 大規模リファクタリング

```
/agent-teams

目標: 認証システムのリファクタリング

teammate-1: OAuth2プロバイダーの実装
teammate-2: JWTトークン管理の改善
teammate-3: セッション管理の更新
teammate-4: 既存テストの更新
```

### 例2: 複数モジュールの新規実装

```
/agent-teams

目標: ダッシュボード機能の実装

teammate-1: バックエンドAPI（4エンドポイント）
teammate-2: フロントエンドコンポーネント
teammate-3: データベースマイグレーション
teammate-4: E2Eテスト作成
```

## 注意事項

- Agent Teamsは実験的機能であり、動作が不安定な場合がある
- コストが高いため、本当に必要な場合のみ使用
- 依存関係が強いタスクはサブエージェントの方が適切
- チームメイトの作業は定期的に確認し、問題があれば介入
