# Claude Code カスタマイズ実践ガイド

## ドキュメント分離の原則

| 対象 | 配置場所 | 用途 |
|------|---------|------|
| **人間向け** | README.md, docs/ | プロジェクト説明、API仕様、アーキテクチャ図 |
| **エージェント向け** | CLAUDE.md, context/ | AI向け指示、作業ルール、ファイル形式 |

### 理由
- README.mdは人間が読むための文書（詳細な説明、装飾）
- CLAUDE.mdはClaudeへの「指示書」（簡潔、実行可能な情報）

---

## CLAUDE.md設計原則

### 1. 60行以下に収める
- 情報を詰め込みすぎるとClaudeが全指示に従う確率が下がる
- 詳細は`@`参照でcontext/に委譲

### 2. Progressive Disclosure（段階的開示）
```markdown
詳細: @context/workflow-rules.md
```
- 必要な時にのみ詳細をロード
- コンテキストウィンドウを節約
- `@`参照は最大5階層まで再帰展開

### 3. 強調表現の活用
- `IMPORTANT`, `YOU MUST` で重要な指示を強調
- 最終ステップの強調パターンが効果的

### 4. 「名詞と動詞」の原則
- CLAUDE.md: 「どこに何があるか（名詞）」
- Commands: 「どう操作するか（動詞）」

---

## Skills / Commands / Subagents / CLAUDE.md の使い分け

| 配置先 | 呼び出し | コンテキスト | 用途 |
|--------|---------|-------------|------|
| **CLAUDE.md** | 自動（常時） | メイン会話 | 常時適用ルール |
| **Skills** | 自動判断 | メイン会話 | ドメイン知識、自動トリガー |
| **Commands** | `/command` | メイン会話 | ユーザー制御のショートカット |
| **Subagents** | 自動委譲 | **独立** | コンテキスト分離、並列処理 |

### Skillsを選ぶ場合
- Claudeが**自動的に使用タイミングを判断**すべき場合
- スクリプトと命令をセットでパッケージ化したい場合
- Claude.ai、Code、Desktop**すべてで使いたい**場合

### Commandsを選ぶ場合
- ユーザーが**明示的にタイミングを制御**したい場合
- **引数を渡して**動的に動作を変えたい場合
- 繰り返し使うプロンプトのショートカット

### Subagentsを選ぶ場合（限定的）
- **コンテキストを分離**したい場合（大量の中間結果でメイン会話を汚さない）
- **複数タスクを並列処理**したい場合
- 特定タスクに**異なるモデル**を使用したい場合

---

## Skills設計のベストプラクティス

### description の書き方
「**何をするか**」+「**いつ使うか**」の両方を含める:

```yaml
# Good
description: PRレビュー。PR番号・ブランチ名指定時またはレビュー依頼時に使用。

# Bad
description: PRレビュー。
```

### Progressive Disclosureの活用
- SKILL.mdは500行以下に抑える
- 詳細は別ファイルに分割（参照は1階層のみ）

```
pdf-skill/
├── SKILL.md        # メイン命令（必須）
├── FORMS.md        # フォーム処理ガイド
└── REFERENCE.md    # APIリファレンス
```

### 3段階のロードシステム
| レベル | ロードタイミング | トークンコスト |
|--------|----------------|---------------|
| Level 1 | 常時（起動時） | 約100トークン/Skill |
| Level 2 | Skillトリガー時 | 5,000トークン未満 |
| Level 3+ | 必要に応じて | 実質無制限 |

---

## ユーザースコープ vs プロジェクトスコープ

| 内容 | 配置場所 | 理由 |
|------|---------|------|
| 作業フロー | ユーザースコープ | 全PJ共通 |
| メモリディレクトリ場所 | **PJスコープ** | モノレポ対応 |
| 品質チェックコマンド | **PJスコープ** | PJ依存 |
| agent cliの使い方 | ユーザースコープ | 全PJ共通 |

 ### スキル/コマンドのスコープ判断基準
**IMPORTANT**: 以下の順で判断する:
1. **連携対象を確認**: 連携するcommand/skillがPJ固有（`.claude/`）なら、**PJスコープ**
2. **PJ固有リソース参照**: `spec/`、`backlog/`等のPJ固有ディレクトリを参照するなら、**PJスコープ**
3. **汎用性**: 上記に該当しない場合のみ、ユーザースコープを検討
---

## ディレクトリ構造（推奨）

### ユーザースコープ
```
~/.claude/
├── CLAUDE.md           # グローバル設定（60行以下）
├── context/            # エージェント向けコンテキスト
├── commands/           # Slash Commands
├── skills/             # Skills
└── templates/          # PJテンプレート
```

### プロジェクトスコープ
```
<project-root>/
├── CLAUDE.md           # エージェント向け: PJ固有ルール
├── README.md           # 人間向け: プロジェクト説明
├── docs/               # 人間向け: API仕様、アーキテクチャ図
└── .claude/
    └── context/        # エージェント向け: PJ固有コンテキスト
```

---

## 継続的改善

- CLAUDE.mdは**静的ドキュメントではなく、生きた文書**
- Claudeが望ましくない動作をした際、修正指示を追記
- 定期的にメモリを見直し、古くなった指示を削除
- `#`キーで適切なCLAUDE.mdに指示を追記（Claude Code機能）
